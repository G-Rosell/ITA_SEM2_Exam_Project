@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject IPersonService PersonService
@using VagtplanApp.Client.Services;

<div class="page">
    @if (!IsLoginPage()) // Viser sidebar == hvis brugeren ikke er på login-siden
    {
        <div class="sidebar">
            <NavMenu /> 
        </div>
    }

    <main>
        <div class="top-row px-4">
            <a href="login" @onclick="LogOut">Log Out</a> <!-- Log ud knap, fører til login-siden -->
        </div>

        <!-- Indhold af den aktuelle side, vises her -->
        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    // Fields:
    private bool isUserLoggedIn;

    // ---------------------------------------------------------------------------------------------------------------------------------------

    // Initialiserer og tjekker brugerens login-status
    protected override async Task OnInitializedAsync()
    {
        isUserLoggedIn = await PersonService.IsUserLoggedInAsync(); // Tjekker om brugeren er logget ind
        if (!isUserLoggedIn && !IsLoginPage()) // Hvis brugeren ikke er logget ind og ikke på login-siden, omdirigeres til login
        {
            NavigationManager.NavigateTo("/login");
        }
    }

    // Tjekker om den nuværende side er login-siden
    private bool IsLoginPage()
    {
        return NavigationManager.Uri.Contains("/login");
    }

    // Logger brugeren ud og omdirigerer til login-siden
    private async Task LogOut()
    {
        await PersonService.LogOut();
        NavigationManager.NavigateTo("/login"); // Omdirigerer til login-siden
    }
}
